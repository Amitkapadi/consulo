<project name="platform-libs">
  <property name="out.dir" value="out-ant"/>
  <property name="lib.dir" value="out-ant/dist/lib"/>
  <property name="tmp.dir" value="out-ant/tmp"/>


  <target name="build" depends="defJavac2, build-util, build-extensions, build-consulo">

  </target>

  <target name="defJavac2">
    <sequential>
      <path id="classpath">
        <fileset dir="lib">
          <include name="*.jar"/>
        </fileset>
        <fileset dir="${lib.dir}">
          <include name="*.jar"/>
        </fileset>
      </path>
      <taskdef name="javac2" classpathref="classpath" classname="com.intellij.ant.Javac2"/>
    </sequential>
  </target>

  <target name="build-extensions">

    <mkdir dir="${tmp.dir}/extensions"/>

    <javac2 classpathref="classpath" srcdir="platform/extensions/src" destdir="${tmp.dir}/extensions"/>

    <jar basedir="${tmp.dir}/extensions" destfile="${lib.dir}/extensions.jar"/>
  </target>

  <target name="build-util">
    <mkdir dir="${tmp.dir}/util"/>

    <javac2 classpathref="classpath" srcdir="platform/util/src:platform/util-rt/src" destdir="${tmp.dir}/util"/>

    <jar basedir="${tmp.dir}/util" destfile="${lib.dir}/util.jar"/>
  </target>

  <target name="build-consulo">
    <path id="classpath">
      <fileset dir="lib">
        <include name="*.jar"/>
      </fileset>
      <fileset dir="${lib.dir}">
        <include name="*.jar"/>
      </fileset>
    </path>

    <mkdir dir="${tmp.dir}/consulo"/>

    <javac2 classpathref="classpath" destdir="${tmp.dir}/consulo">
      <src path="platform/analysis-api/src"/>
      <src path="platform/analysis-impl/src"/>
      <src path="platform/boot/src"/>
      <src path="platform/bootstrap/src"/>
      <src path="platform/compiler-api/src"/>
      <src path="platform/compiler-artifact-api/src"/>
      <src path="platform/compiler-artifact-impl/src"/>
      <src path="platform/compiler-bridge-impl/src"/>
      <src path="platform/compiler-impl/src"/>
      <src path="platform/compiler-server-impl/src"/>
      <src path="platform/core-api/src"/>
      <src path="platform/core-impl/src"/>
      <src path="platform/dvcs/src"/>
      <src path="platform/editor-ui-api/src"/>
      <src path="platform/editor-ui-ex/src"/>
      <src path="platform/external-system-api/src"/>
      <src path="platform/external-system-impl/src"/>
      <src path="platform/indexing-api/src"/>
      <src path="platform/indexing-impl/src"/>
      <src path="platform/graph-api/src"/>
      <src path="platform/graph-impl/src"/>
      <src path="platform/lang-api/src"/>
      <src path="platform/lang-impl/src"/>
      <src path="platform/lvcs-api/src"/>
      <src path="platform/lvcs-impl/src"/>
      <src path="platform/platform-api/src"/>
      <src path="platform/platform-impl/src"/>
      <src path="platform/platform-main/src"/>
      <src path="platform/projectImportModel/src"/>
      <src path="platform/projectModel-api/src"/>
      <src path="platform/projectModel-impl/src"/>
      <src path="platform/remote-servers-agent-rt/src"/>
      <src path="platform/remote-servers-api/src"/>
      <src path="platform/remote-servers-impl/src"/>
      <src path="platform/smRunner/src"/>
      <src path="platform/testFramework/src"/>
      <src path="platform/testFramework/bootstrap/src"/>
      <src path="platform/testRunner/src"/>
      <src path="platform/usageView/src"/>
      <src path="platform/vcs-api/src"/>
      <src path="platform/vcs-impl/src"/>
      <src path="platform/vcs-log/api/src"/>
      <src path="platform/vcs-log/graph/src"/>
      <src path="platform/vcs-log/impl/src"/>
      <src path="platform/xdebugger-api/src"/>
      <src path="platform/xdebugger-impl/src"/>
    </javac2>

    <jar basedir="${tmp.dir}/consulo" destfile="${lib.dir}/idea.jar"/>
  </target>
</project>